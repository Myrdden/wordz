<!DOCTYPE html>
<html>
<head>
  <title>Thing</title>
</head>
<body>
<div id='root'></div>

<script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
<script>
const elem = React.createElement;

const Dictionary = props => {
  const populate = data => {
    return data.map((word, index) => {
      if (word.type === 0) {
        return elem(Noun, {...word, key: index}, null);
      } else {
        return elem(Verb, {...word, key: index}, null);
      }
    });
  }

  return elem('div', {},
    populate(props.data)
  );
};

const Noun = props => {
  return elem('div', {className: 'word'},
    elem('h1', {}, props.header)
  );
};

const Verb = props => {
  const [shown, setShown] = React.useState(false);
  const toggleChart = e => {
    e.preventDefault();
    setShown(!shown);
  };

  return elem('div', {className: 'word'},
    elem('h1', {}, props.header),
    elem('p', {}, props.participle),
    elem('p', {}, props.gerunds.reduce((str, ger) => str + ' ' + ger, 'Gerund:')),
    elem('ol', {}, props.definitions.map((def, i) => elem('li', {key: i}, def))),
    elem('button', {onClick: e => toggleChart(e)}, 'clicc'),
    elem(Chart, {shown: shown, data: props.stems}, null)
  );
};

const Chart = props => {
  const isShown = () => {
    return (props.shown ? 'chart' : 'hidden');
  };

  const headers = ['', 'Perfective', 'Imperfective', 'Subjunctive', 'Imperative'];
  const rowHeaders = ['Absolute', 'Conjunct', 'Compound', 'Complex'];

  return elem('div', {className: isShown()},
    elem('table', {},
      elem('tbody', {},
        elem('tr', {}, headers.map((header, i) => elem('th', {key: i}, header))),
        props.data.map((row, i) => {
          return elem('tr', {key: i},
            elem('th', {}, rowHeaders[i]),
            row.map((word, i) => elem('td', {key: i}, word)),
          )
        })
      )
    )
  );
};

const Input = ({setData}) => {
  const upload = e => {
    e.preventDefault();
    localStorage.clear();
    let reader = new FileReader();
    reader.onload = () => {
      let data = JSON.parse(reader.result);
      data.sort((a,b) => {
        let x = a.header.toUpperCase();
        let y = b.header.toUpperCase();
        return x < y ? -1 : (x > y ? 1 : 0);
      });
      setData(data);
    };
    reader.readAsText(e.target.files[0]);
  };

  return elem('div', {},
    elem('input', {type: 'file', name:'file', onChange: e => upload(e)}, null)
  );
};

const Output = ({data}) => {
  let blob = new Blob([JSON.stringify(data)], {type: 'text/plain;charset=utf-8'});
  return elem('a', {href: URL.createObjectURL(blob), download: 'hecc.txt'}, 'clicc');
}

const App = () => {
  const [data, setData] = React.useState(null);

  React.useEffect(() => {
    localStorage.setItem('data', JSON.stringify(data));
  }, [data]);

  if (data === null) {
    if (localStorage.getItem('data') !== 'null' && localStorage.getItem('data') !== null) {
      setData(JSON.parse(localStorage.getItem('data')));
    }
  }
  //localStorage.clear();
  console.log(data);
  console.log(localStorage.getItem('data'));
  return elem('div', {},
    elem(Input, {setData: setData}, null),
    elem('button', {onClick: () => {setData(null); localStorage.clear();}}, 'Clear'),
    (data !== {} && data !== null) && elem('div', {},
      elem(Output, {data: data}, null),
      elem(Dictionary, {data: data}, null)
    )
  );
};

ReactDOM.render(elem(App), document.getElementById('root'));
</script>
<style>
  .hidden {display: none}
  .word {
    background: dimgrey;
    margin: 2rem;
  }

  .chart {

  }
</style>
</body>
</html>
